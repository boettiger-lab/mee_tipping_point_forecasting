---
title: Estimating Uncertainty for Tipping Points with Deep Learning
authors:
  - name: Marcus Lapeyrolerie
    department: Department of Environmental Science, Policy, and Management
    affiliation: University of California, Berkeley
    location: Berkeley, California
    email: mlapeyro@berkeley.edu
  - name: Carl Boettiger
    department: Department of Environmental Science, Policy, and Management
    affiliation: University of California, Berkeley
    location: Berkeley, California
    email: cboettig@berkeley.edu (corresponding author)
abstract: |
  1. Meaningful representations of uncertainty are an essential component of effective ecological forecasting.
  2. Machine learning
  3. We examine scenarios in which stochasticity and non-linearity can lead to extreme uncertainty under common ecological models.  
  4. We show that ..
  
keywords:
  - Time Series
  - Forecasting
  - Machine Learning
  - Artificial Intelligence
  - Tipping points
bibliography: references.bib
nocite: |
    
header-includes:
  - \usepackage{amsmath}
  - \usepackage{amssymb}
#  - \usepackage{lineno}
#  - \usepackage{endfloat}
#  - \linenumbers
  
output: 
  rticles::arxiv_article:
    keep_tex: true
  word_document: default
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup}
library(tidyverse)
library(patchwork)
```



# Introduction

Uncertainty important to forecasting [@Deitze2018] and  decision-making [@Schindler2015]

Machine learning is increasingly effective at forecasting, but methods often focus on creation or assessment only of point predictions [@]. 
Because uncertainty can play such an intrinsic role in ecological dynamics [@Boettiger2018; @Coulson2004; @Oveskienen], it is essential that machine learning applications to ecological forecasting are able to address probablistic forecasts adequately.
We evaluate the ability of some of the most promising machine learning methods for probabilistic forecasts relative to traditional statistical and mechanistic approaches applied to several classic models in ecology.

# Materials and Methods

<!-- some more verbose bits about bifurcation models probably belongs in discussion instead -->
We will focus the analysis of several different forecasting scenarios based around two classic models in population ecology: 
Robert May's consumer-resource model [@May1979], and the Nicholson-Bailey parasatoid-host model [@Nicholson1935]. 
While 'tactical' population dynamics models used to inform decision making in fields such as fisheries are often much more complex, these simple models nevertheless exhibit rich nonlinear dynamics thought to be typical in ecological systems [].
These textbook models have been well studied and form the basis of half a century of research in ecology, including much recent work on topics such as resilience and tipping points [] which has had important theoretical and practical management outcomes [@Folke2009; @].
May's model exhibits alternative stable states. 
In this one-dimensional model, transitions between these states can occur due to intrinsic stochasticity, external forcing, or the gradual environmental change that results in a catastrophic saddle-node bifurcation and generates hysteresis. 
The Nicholson-Bailey model is a two species model which contains a Hopf bifurcation, a non-catastrophic bifurcation which either creates or destroys a limit cycle -- a stable oscillatory pattern. 

Assessing the accuracy of forecasting methods in the face of such bifurcation dynamics is particularly important question for ecological systems and global environmental change problems.
Bifurcations represent the kind of non-linear responses complex systems can make as the result of slowly changing parameters (i.e. the 'environment' in which those dynamics take place.)
This can create a particularly challenging forecasting task when such transitions have not been previously observed in the same system, requiring the forecast to anticipate dynamics for which there are no corresponding analogue in the historical data to date. 
No-analog scenarios [@Williams]


```{r fig.cap="Forecast scenarios. A. a Hopf bifurcation: a stable node develops into a limit cycle. B. The saddle-node bifurcation."}
hopf <- read_csv("../greta/data/hopf_increasing.csv.gz")
panelA <- hopf |> filter(type %in% c("historical", "true"), i < 10) |>
  rename(species = variable) |> 
  mutate(species = forcats::fct_recode(species, host = "H", parasitoid = "P")) |>
  ggplot(aes(t, value, group=interaction(species, i, type), col=species)) + 
  geom_line(show.legend = FALSE, alpha = 0.7) + theme_bw()+  scale_color_grey() +
  ggtitle("A. Hopf bifurcation")

sn <- read_csv("../greta/data/saddlenode.csv.gz")
panelB <- sn |> filter(type == "historical", i == 1) |>
  bind_rows(filter(sn, type=="true")|>mutate(type="predicted")) |>
  ggplot(aes(t, value, col = type, group=interaction(i,type), lty=type)) +
  geom_path(alpha=0.5, show.legend = FALSE) +
  scale_color_grey(end=0.6) + theme_bw() + 
  ggtitle("B. Saddle-node bifurcation")

stoch <- read_csv("../greta/data/stochastic.csv.gz")
panelC <- stoch |> filter(type == "historical", i == 1) |>
  bind_rows(filter(stoch, type=="true", i < 50) |> mutate(type="predicted")) |>
  ggplot(aes(t, value, col = type, group=interaction(i,type), lty=type)) +
  geom_path(alpha=0.5) + scale_color_grey(end=0.6) + theme_bw() + 
  ggtitle("C. Stochastic transition")


panelA / panelB / panelC

```

## Scenario 1: Hopf Bifurcation

The Nicholson-Bailey model describes a predator-prey dynamic for the relationship of a host species and an obligate parsatiod, orignally used to model the population dynamics of blowflies (_Lucilia cuprina_) [@Nicholson1935; @Nicholson1954a; @Nicholson1954b; @Hastings].
We consider the form which includes density dependence in the host species, and allow for environmental stochasticity,

\begin{equation}
\label{hopf}
\end{equation}

Following @Dakos2012, we further allow the carrying capacity of the host, $K$ to slowly increase at linear rate, $K = K_0 + \delta t$, which drives a Hopf bifurcation as $K$ becomes sufficiently large. 
In a Hopf bifurcation, a stable node starts an oscillatory pattern, which continues to grow in amplitude as the bifurcation parameter continues to increase.
This example illustrates one of the many kinds of challenges which nonlinear phenomena pose to forecasting: the "historical" data prior to the bifurcation never exhibit the cyclical dynamics of growing amplitude that will emerge after the bifurcation occurs.
If we had used a purely deterministic model, the dynamics would be constrained to a single stable point, corresponding to a slowly changing steady-state population size of host and parasitoid populations.
However, stochasticity in this case acts as a source of some additional information about the dynamics, as the noise excites quasi-cycles which are visible in the irregular oscillations that appear significantly prior to the emergence of true limit cycles which follow the bifurcation [@Boettiger2018].


## Scenario 2: The saddle-node bifurcation

A yet more difficult forecasting scenario is created by the saddle-node bifurcation.
May's consumer-resource model is a one-dimensional model describing the growth of a 'resource' population (e.g. herbivore) which is grazed by a consumer [@May1979].
As in the Nicholson-Bailey model, in the absence of that predation the resource population density grows under a density-dependent pattern described by a logistic function.
Meanwhile, the resource population is also grazed by a consumer at a rate given by a Holling type III s-curve (typically used to model handling time). 

## Scenario 3: The stochastic transition

Hardest of all events to predict are those transitions which are predominately driven by a random component. 
An example of such a transition event is possible to observe in May's consumer-resource model, in which a stochastic term occasionally results in a transition between alternative stable states.
In such cases, no forecast can precisely predict when a transition will occur, but it is nonetheless possible to deduce the correct distribution of waiting times knowing the correct model. 
In the case of small noise, transitions are Poisson distributed, such that the distribution of waiting times is roughly exponential [e.g. @vanKampen], though post-hoc the trajectories of such transitions can be mistaken for saddle-node transitions [@prosectorsfallacy].



## Method group 1: Markov Chain Monte Carlo

As a reference case, we consider the forecast produced by an MCMC estimate of model parameters, _given the true model_.
This represents an idealized case where the nature of the underlying process is known precisely.
Uncertainty comes from parameter estimates and intrinsic stochasticity specified in the model, but does not reflect any uncertainty in our knowledge of the model structure. 
Alternative model structures, even when capable of producing the same nonlinear phenomena (i.e. the same bifurcations) will give very different forecasts. 
Even alternative prior distributions of the parameters will generally yield alternate forecasts, as likelihood ridges are common to nonlinear models.
Thus, this case represents a theoretical upper bound for the performance of forecasts by techniques which do not make such strong assumptions about the underlying processes.


## Method group 2: Statistical models (ARIMA)



## Method group 3: Machine Learning models



# Results


# Discussion


\pagebreak

# References
